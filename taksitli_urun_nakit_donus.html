<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Taksitli Ürün Nakit Dönüşüm Hesabı</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f3f4f6;
        }
        .input-group label {
            font-size: 0.875rem;
            font-weight: 600;
            color: #374151;
            margin-bottom: 0.25rem;
            display: block;
        }
        .input-box {
            width: 100%;
            padding: 0.75rem;
            border-radius: 0.5rem;
            border: 1px solid #d1d5db;
            outline: none;
            transition: border-color 0.2s;
        }
        .input-box:focus {
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        .result-card {
            animation: fadeIn 0.5s ease-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center py-10 px-4">

    <div class="bg-white w-full max-w-2xl rounded-2xl shadow-xl overflow-hidden">
        <!-- Header -->
        <div class="bg-gradient-to-r from-blue-600 to-indigo-700 p-6 text-white text-center">
            <h1 class="text-2xl font-bold"><i class="fa-solid fa-calculator mr-2"></i>Taksit / Nakit Dönüşüm Analizi</h1>
            <p class="text-blue-100 text-sm mt-2">Taksitli aldığınız ürünü satıp faize yatırarak kar/zarar durumunuzu hesaplayın.</p>
        </div>

        <div class="p-6 space-y-6">
            
            <!-- Input Grid -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Ürün Maliyeti -->
                <div class="input-group">
                    <label>Ürünün Toplam Alış Fiyatı (TL)</label>
                    <input type="number" id="purchasePrice" class="input-box" placeholder="Örn: 25000">
                </div>

                <!-- Faiz Oranı -->
                <div class="input-group">
                    <label>Yıllık Brüt Mevduat Faizi (%)</label>
                    <div class="relative">
                        <input type="number" id="interestRate" class="input-box pl-10" placeholder="Örn: 50">
                        <span class="absolute left-3 top-3 text-gray-400"><i class="fa-solid fa-percent"></i></span>
                    </div>
                    <p class="text-xs text-gray-500 mt-1">*Net hesap için %5 stopaj otomatik düşülecektir.</p>
                </div>

                <!-- Taksit Sayısı -->
                <div class="input-group">
                    <label>Taksit Sayısı (Ay)</label>
                    <input type="number" id="installments" class="input-box" placeholder="Örn: 12">
                </div>

                <!-- Taksit Tutarı -->
                <div class="input-group">
                    <label>Aylık Taksit Tutarı (TL)</label>
                    <input type="number" id="installmentAmount" class="input-box" placeholder="Örn: 2500">
                </div>
            </div>

            <hr class="border-gray-200">

            <!-- Calculation Mode Selection -->
            <div>
                <label class="text-sm font-bold text-gray-700 mb-3 block">Ne yapmak istiyorsunuz?</label>
                <div class="flex flex-col sm:flex-row gap-4">
                    <label class="flex-1 cursor-pointer">
                        <input type="radio" name="mode" value="check" class="peer sr-only" checked onchange="toggleMode()">
                        <div class="p-4 rounded-lg border-2 border-gray-200 peer-checked:border-blue-500 peer-checked:bg-blue-50 transition text-center hover:bg-gray-50">
                            <i class="fa-solid fa-scale-balanced mb-2 text-xl text-gray-600 peer-checked:text-blue-600"></i>
                            <div class="font-semibold text-gray-700">Kar/Zarar Kontrolü</div>
                            <div class="text-xs text-gray-500">Satış fiyatını ben gireyim</div>
                        </div>
                    </label>
                    
                    <label class="flex-1 cursor-pointer">
                        <input type="radio" name="mode" value="min" class="peer sr-only" onchange="toggleMode()">
                        <div class="p-4 rounded-lg border-2 border-gray-200 peer-checked:border-green-500 peer-checked:bg-green-50 transition text-center hover:bg-gray-50">
                            <i class="fa-solid fa-shield-halved mb-2 text-xl text-gray-600 peer-checked:text-green-600"></i>
                            <div class="font-semibold text-gray-700">Minimum Fiyatı Bul</div>
                            <div class="text-xs text-gray-500">Zarar etmemek için kaça satmalıyım?</div>
                        </div>
                    </label>
                </div>
            </div>

            <!-- Dynamic Input for Selling Price -->
            <div id="sellingPriceContainer" class="input-group transition-all duration-300">
                <label>Planladığınız Satış Fiyatı (TL)</label>
                <input type="number" id="sellingPrice" class="input-box border-blue-300 bg-blue-50" placeholder="Ürünü kaça satacaksınız?">
            </div>

            <!-- Action Button -->
            <button onclick="calculate()" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-4 rounded-xl shadow-lg transform transition active:scale-95 flex items-center justify-center text-lg">
                <i class="fa-solid fa-calculator mr-2"></i> Hesapla
            </button>

            <!-- Results Section -->
            <div id="resultArea" class="hidden space-y-4">
                <!-- Main Result Card -->
                <div id="mainResultCard" class="p-6 rounded-xl border-l-8 shadow-sm">
                    <h3 id="resultTitle" class="text-lg font-bold mb-2">Sonuç</h3>
                    <p id="resultText" class="text-2xl font-bold"></p>
                    <p id="resultSubtext" class="text-sm mt-2 opacity-90"></p>
                </div>

                <!-- Details Grid -->
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 text-sm">
                    <div class="bg-gray-100 p-4 rounded-lg">
                        <div class="text-gray-500">Toplam Ödenecek Taksit</div>
                        <div class="font-bold text-gray-800 text-lg" id="totalInstallmentPayment">0 TL</div>
                    </div>
                    <div class="bg-gray-100 p-4 rounded-lg">
                        <div class="text-gray-500">Efektif Aylık Net Faiz</div>
                        <div class="font-bold text-gray-800 text-lg" id="monthlyNetRateDisplay">%0</div>
                    </div>
                </div>

                <!-- Explanation -->
                <div class="bg-yellow-50 border border-yellow-200 p-4 rounded-lg text-sm text-yellow-800">
                    <p><i class="fa-solid fa-circle-info mr-1"></i> <strong>Mantık:</strong> Bu hesaplama, elinize geçen parayı bankaya yatırıp her ay taksit tutarını o hesaptan (ana para + faiz getirisi) ödediğiniz senaryoya dayanır. Finansal olarak "Anüitenin Bugünkü Değeri" formülü kullanılmıştır. Stopaj %5 kabul edilmiştir.</p>
                </div>
            </div>

        </div>
    </div>

    <script>
        // Set default behavior
        function toggleMode() {
            const mode = document.querySelector('input[name="mode"]:checked').value;
            const container = document.getElementById('sellingPriceContainer');
            
            if (mode === 'check') {
                container.classList.remove('hidden');
                container.classList.add('block');
            } else {
                container.classList.remove('block');
                container.classList.add('hidden');
            }
            
            // Hide previous results
            document.getElementById('resultArea').classList.add('hidden');
        }

        function formatMoney(amount) {
            return new Intl.NumberFormat('tr-TR', { style: 'currency', currency: 'TRY' }).format(amount);
        }

        function calculate() {
            // Inputs
            const totalPurchasePrice = parseFloat(document.getElementById('purchasePrice').value) || 0;
            const grossRate = parseFloat(document.getElementById('interestRate').value);
            const installmentCount = parseInt(document.getElementById('installments').value);
            const installmentAmount = parseFloat(document.getElementById('installmentAmount').value);
            const mode = document.querySelector('input[name="mode"]:checked').value;
            
            // Validation
            if (!grossRate || !installmentCount || !installmentAmount) {
                alert("Lütfen faiz oranı, taksit sayısı ve taksit tutarını giriniz.");
                return;
            }

            // Calculation Logic (TVM - Present Value of Annuity)
            // 1. Calculate Monthly Net Rate
            // Stopaj (Tax) is assumed 5% for standard short/medium term deposits in TR
            const stopaj = 0.05; 
            const netAnnualRate = grossRate * (1 - stopaj);
            const monthlyRate = (netAnnualRate / 12) / 100;

            // 2. Calculate Break Even Price (Present Value of the debt)
            // Formula: PV = PMT * [ (1 - (1+r)^-n) / r ]
            let breakEvenPrice;
            if (monthlyRate === 0) {
                breakEvenPrice = installmentAmount * installmentCount;
            } else {
                breakEvenPrice = installmentAmount * ( (1 - Math.pow(1 + monthlyRate, -installmentCount)) / monthlyRate );
            }

            const totalInstallmentCost = installmentAmount * installmentCount;

            // UI Updates
            const resultArea = document.getElementById('resultArea');
            const mainCard = document.getElementById('mainResultCard');
            const resultTitle = document.getElementById('resultTitle');
            const resultText = document.getElementById('resultText');
            const resultSubtext = document.getElementById('resultSubtext');

            document.getElementById('totalInstallmentPayment').innerText = formatMoney(totalInstallmentCost);
            document.getElementById('monthlyNetRateDisplay').innerText = '%' + (monthlyRate * 100).toFixed(4);

            resultArea.classList.remove('hidden');

            if (mode === 'min') {
                // Scenario B: Show Minimum Price
                mainCard.className = "p-6 rounded-xl border-l-8 shadow-sm bg-blue-50 border-blue-500 text-blue-900";
                resultTitle.innerText = "Zarar Etmemek İçin Gereken Minimum Satış Fiyatı";
                resultText.innerText = formatMoney(breakEvenPrice);
                
                const diff = totalPurchasePrice - breakEvenPrice;
                
                if(totalPurchasePrice > 0) {
                    resultSubtext.innerHTML = `Eğer bu fiyata satarsanız, paranızı bankaya koyup tüm taksitleri cepten para çıkmadan ödeyebilirsiniz.<br>Bu işlem için ürünün kendi fiyatından <strong>${formatMoney(totalPurchasePrice - breakEvenPrice)}</strong> kadar aşağı inebilirsiniz.`;
                } else {
                     resultSubtext.innerText = "Bu tutarı bankaya yatırırsanız, aylık faiz ve anapara çekilişleriyle tüm taksitler tam olarak ödenir.";
                }

            } else {
                // Scenario A: Check Profit/Loss
                const sellingPrice = parseFloat(document.getElementById('sellingPrice').value);
                
                if (!sellingPrice) {
                    alert("Lütfen satış fiyatı giriniz.");
                    return;
                }

                if (sellingPrice >= breakEvenPrice) {
                    // Profit
                    const profit = sellingPrice - breakEvenPrice;
                    mainCard.className = "p-6 rounded-xl border-l-8 shadow-sm bg-green-50 border-green-500 text-green-900";
                    resultTitle.innerText = "Kâr Ediyorsunuz! (Avantajlı Satış)";
                    resultText.innerText = `Net Kârınız: ${formatMoney(profit)}`; // This is present value profit
                    resultSubtext.innerText = `Bu fiyata satıp parayı faize koyarsanız, tüm taksitleri ödedikten sonra cebinizde bugünün parasıyla fazladan bu kadar para kalır. (Minimum satmanız gereken fiyat: ${formatMoney(breakEvenPrice)})`;
                } else {
                    // Loss
                    const loss = breakEvenPrice - sellingPrice;
                    mainCard.className = "p-6 rounded-xl border-l-8 shadow-sm bg-red-50 border-red-500 text-red-900";
                    resultTitle.innerText = "Zarar Ediyorsunuz!";
                    resultText.innerText = `Zararınız: ${formatMoney(loss)}`;
                    resultSubtext.innerText = `Bu fiyata satarsanız, bankadaki paranız taksitleri ödemeye yetmeyecek. Taksitleri bitirmek için cebinizden bugünün değeriyle ${formatMoney(loss)} daha eklemeniz gerekecek. (Minimum satmanız gereken fiyat: ${formatMoney(breakEvenPrice)})`;
                }
            }
        }
    </script>
</body>
</html>
